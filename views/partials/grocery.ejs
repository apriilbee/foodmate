<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head') %>
  <link rel="stylesheet" href="/css/meal-planner.css" />

  <body>
    <%- include('partials/navbar') %>

    <div class="container">
      <h1 class="page-title">Meal Planner</h1>

      <!-- Generate Button -->
      <button id="generate-list-btn" class="generate-btn">Generate Grocery List</button>

      <!-- List Container -->
      <div id="grocery-list-container"></div>
    </div>

    <script>
      document.getElementById("generate-list-btn").addEventListener("click", async () => {
        try {
          const res = await fetch("/grocery/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" }
          });

          const data = await res.json();
          displayGroceryList(data);
        } catch (err) {
          console.error("Failed to generate list:", err);
        }
      });

      function displayGroceryList(items) {
        const container = document.getElementById("grocery-list-container");
        container.innerHTML = "";

        const grouped = {};
        items.forEach(item => {
          const category = item.category || "Others";
          if (!grouped[category]) grouped[category] = [];
          grouped[category].push(item);
        });

        for (let cat in grouped) {
          const section = document.createElement("div");
          section.classList.add("category-group");
          section.innerHTML = `<h3>${cat}</h3>`;

          grouped[cat].forEach(i => {
            const item = document.createElement("div");
            item.classList.add("grocery-item");

            item.innerHTML = `
              <label class="checkbox-wrapper">
                <input type="checkbox" />
                <span>${i.name} - ${i.quantity} ${i.unit}</span>
              </label>
            `;

            section.appendChild(item);
          });

          container.appendChild(section);
        }
      }
    </script>
  </body>
</html>

