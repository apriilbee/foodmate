<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head') %>
  <link rel="stylesheet" href="/css/grocery.css?v=<%= Date.now() %>" />
  <body>
    <%- include('partials/navbar') %>

    <div class="grocery-page">
      <h1 class="grocery-title">Grocery List</h1>

      <div class="date-generate-row">
        <div class="date-generate-card">
          <div class="date-field">
            <label for="startDate">Start Date:</label>
            <div class="date-input-wrapper">
              <input type="date" id="startDate" />
            </div>
          </div>
          <div class="date-field">
            <label for="endDate">End Date:</label>
            <div class="date-input-wrapper">
              <input type="date" id="endDate" />
            </div>
          </div>
          <button id="generate-list-btn" class="generate-btn">Generate</button>
        </div>
      </div>

      <div id="grocery-list-container" class="grocery-list-section">
        <!-- List will be populated here dynamically -->
      </div>
    </div>

    <script>
      document.getElementById("generate-list-btn").addEventListener("click", async () => {
        const start = document.getElementById("startDate").value;
        const end = document.getElementById("endDate").value;

        if (!start || !end) {
          alert("Please select start and end dates");
          return;
        }

        try {
          const res = await fetch("/grocery/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ startDate: start, endDate: end })
          });

          const data = await res.json();
          displayGroceryList(data);
        } catch (err) {
          console.error("Failed to fetch grocery list:", err);
        }
      });

      function displayGroceryList(items) {
        const container = document.getElementById("grocery-list-container");
        container.innerHTML = "";

        const grouped = {};
        items.forEach(item => {
          const category = item.category || "Others";
          if (!grouped[category]) grouped[category] = [];
          grouped[category].push(item);
        });

        for (let cat in grouped) {
          const section = document.createElement("div");
          section.classList.add("grocery-category");
          section.innerHTML = `<h3 class="category-title">${cat}</h3>`;

          grouped[cat].forEach(i => {
            const item = document.createElement("div");
            item.innerHTML = `
              <label class="checkbox-item">
                <input type="checkbox" />
                <span>${i.name} - ${i.quantity} ${i.unit}</span>
              </label>
            `;
            section.appendChild(item);
          });

          container.appendChild(section);
        }
      }
    </script>
  </body>
</html>
